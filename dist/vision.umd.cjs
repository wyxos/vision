(function(d,s){typeof exports=="object"&&typeof module<"u"?s(exports,require("vue"),require("moment"),require("axios"),require("@oruga-ui/oruga-next")):typeof define=="function"&&define.amd?define(["exports","vue","moment","axios","@oruga-ui/oruga-next"],s):(d=typeof globalThis<"u"?globalThis:d||self,s(d.Vision={},d.Vue,d.moment,d.axios,d.Oruga))})(this,function(d,s,_,m,k){"use strict";var Fr=Object.defineProperty;var kr=(d,s,_)=>s in d?Fr(d,s,{enumerable:!0,configurable:!0,writable:!0,value:_}):d[s]=_;var h=(d,s,_)=>(kr(d,typeof s!="symbol"?s+"":s,_),_);const g=(r,e)=>{const t=r.__vccOpts||r;for(const[n,i]of e)t[n]=i;return t},Se={name:"WyxosButton",props:{loading:{default:!1,type:Boolean},text:{type:String,default:"Processing..."}}},we={key:2,class:"fas fa-spinner fa-spin"};function Ce(r,e,t,n,i,o){const a=s.resolveComponent("o-button");return s.openBlock(),s.createBlock(a,{disabled:t.loading},{default:s.withCtx(()=>[t.loading?s.createCommentVNode("",!0):s.renderSlot(r.$slots,"default",{key:0},()=>[s.createTextVNode("Submit")]),t.loading&&t.text?s.renderSlot(r.$slots,"loading",{key:1},()=>[s.createTextVNode(s.toDisplayString(t.text),1)]):s.createCommentVNode("",!0),t.loading?(s.openBlock(),s.createElementBlock("i",we)):s.createCommentVNode("",!0)]),_:3},8,["disabled"])}const A=g(Se,[["render",Ce]]),Ve=Object.freeze(Object.defineProperty({__proto__:null,default:A},Symbol.toStringTag,{value:"Module"})),Oe={name:"WyxosCollection",props:{modelValue:{required:!0,type:Array}},emits:["update:modelValue"],data(){return{items:[]}},mounted(){this.items=this.modelValue},methods:{add(r){this.items.push(r),this.$emit("update:modelValue",this.items)},remove(r){this.items.splice(r,1),this.$emit("update:modelValue",this.items)}}},Ee=s.createElementVNode("ul",null,[s.createElementVNode("li")],-1);function Fe(r,e,t,n,i,o){return s.renderSlot(r.$slots,"default",s.normalizeProps(s.guardReactiveProps({add:o.add,remove:o.remove,items:i.items})),()=>[Ee])}const D=g(Oe,[["render",Fe]]),ke=Object.freeze(Object.defineProperty({__proto__:null,default:D},Symbol.toStringTag,{value:"Module"}));class y{constructor(){h(this,"state",s.reactive({isLoading:!1,isLoaded:!1,isFailure:!1}))}get isLoading(){return this.state.isLoading}get isLoaded(){return this.state.isLoaded}get isFailure(){return this.state.isFailure}isState(e){return this.state[e]}loading(){Object.assign(this.state,{isLoading:!0,isLoaded:!1,isFailure:!1})}loaded(){Object.assign(this.state,{isLoading:!1,isLoaded:!0,isFailure:!1})}failed(){Object.assign(this.state,{isLoading:!1,isLoaded:!1,isFailure:!0})}reset(){Object.assign(this.state,{isLoading:!1,isLoaded:!1,isFailure:!1})}static create(){return new y}}const qe={name:"WyxosConfirm",props:{title:{type:String,default:"Title"},message:{type:String,default:""},confirmText:{type:String,default:""},confirmType:{type:String,default:""},cancelText:{type:String,default:""},loading:{type:Boolean},callback:{type:Function,default:null}},emits:["close"],setup(){return{state:new y}},methods:{async proceed(){this.callback&&(this.state.loading(),await this.callback().catch(r=>{throw this.state.failed(),r}),this.state.loaded()),this.$emit("close",{action:!0})}}},xe={class:"bg-white p-6"},Ne={class:"title"},Be={class:"mb-6"},je={class:"buttons",role:"group"};function $e(r,e,t,n,i,o){const a=s.resolveComponent("wyxos-button"),l=s.resolveComponent("o-modal");return s.openBlock(),s.createBlock(l,{active:!0,onClose:e[2]||(e[2]=c=>r.$emit("close",{action:!1}))},{default:s.withCtx(()=>[s.createElementVNode("section",xe,[s.createElementVNode("article",null,[s.createElementVNode("header",null,[s.createElementVNode("h3",Ne,s.toDisplayString(t.title),1)]),s.createElementVNode("p",Be,s.toDisplayString(t.message),1),s.createElementVNode("footer",je,[s.createVNode(a,{disabled:n.state.isLoading,class:"button secondary","native-type":"button",onClick:e[0]||(e[0]=c=>r.$emit("close",{action:!1}))},{default:s.withCtx(()=>[s.createTextVNode(s.toDisplayString(t.cancelText),1)]),_:1},8,["disabled"]),s.createVNode(a,{class:s.normalizeClass([{[t.confirmType]:!0},"button"]),loading:n.state.isLoading,"native-type":"button",onClick:e[1]||(e[1]=c=>o.proceed())},{default:s.withCtx(()=>[s.createTextVNode(s.toDisplayString(t.confirmText),1)]),_:1},8,["class","loading"])])])])]),_:1})}const U=g(qe,[["render",$e]]),Te=Object.freeze(Object.defineProperty({__proto__:null,default:U},Symbol.toStringTag,{value:"Module"})),V=s.reactive({default:[]});function O(){return{createBag(r){V[r]||(V[r]=[])},set(r,e="default"){if(!(r.response&&r.response.data&&r.response.data.errors))throw r;V[e]=Object.keys(r.response.data.errors).map(n=>({key:n,message:r.response.data.errors[n][0]}))},get(r,e="default"){const t=V[e];if(!t)return{message:"",variant:""};const n=t.find(i=>Array.isArray(r)?r.includes(i.key):i.key===r);return n?{message:n.message,variant:"danger"}:{message:"",variant:""}},clear(r=null,e="default"){if(r){const t=V[e];if(!t){console.warn(`Bag ${e} is not defined.`);return}const n=t.findIndex(i=>i.key===r);t.splice(n,1);return}V[e]=[]},all(r="default"){return V[r]}}}class w{constructor(e={}){h(this,"errors",null);h(this,"errorBag","default");h(this,"model",s.reactive({}));h(this,"form",s.reactive({}));h(this,"original",{});h(this,"states",{load:y.create(),submit:y.create()});h(this,"paths",{load:null,submit:null});h(this,"abortController",null);h(this,"timeout",null);return this.errors=O(),this.errors.createBag(this.errorBag),this.setAttributes(e),this.loaded(),new Proxy(this,{get(t,n,i){if(Reflect.has(t,n))return Reflect.get(t,n,i);if(Reflect.has(t.form,n)){const o=n.split(".");if(o.length>1){let a=t.form;for(let l=0;l<o.length;l++)a=a[o[l]];return a??void 0}return Reflect.get(t.form,n)}},set(t,n,i,o){if(Reflect.has(t,n))return Reflect.set(t,n,i,o);if(Reflect.has(t.form,n)){const a=n.split(".");if(a.length>1){let l=t.form;for(let c=0;c<a.length-1;c++)a[c]in l||(l[a[c]]={}),l=l[a[c]];return l[a[a.length-1]]===void 0?!1:(l[a[a.length-1]]=i,!0)}return Reflect.set(t.form,n,i)}return!1}})}get isSubmitting(){return this.states.submit.isLoading}get isSubmitted(){return this.states.submit.isLoaded}get isSubmitFailed(){return this.states.submit.isFailure}get isLoading(){return this.states.load.isLoading}get isLoaded(){return this.states.load.isLoaded}get isFailure(){return this.states.load.isFailure}get isDirty(){return JSON.stringify(this.original)!==JSON.stringify(this.form)}static create(e){return new this(e)}setPaths(e={}){return Object.assign(this.paths,e),this}setLoad(e){return this.paths.load=e,this}setSubmit(e){return this.paths.submit=e,this}setErrors(e){this.errorBag=e||"default",this.errors=O(),this.errors.createBag(this.errorBag)}setAttributes(e){this.original=e,this.form=s.reactive({...e})}getError(e){return this.errors.get(e,this.errorBag)}clearError(e){this.errors.clear(e,this.errorBag)}get(e=null,{formatter:t=null,...n}={}){return this.submitRequest("get",e,{formatter:t,...n})}post(e=null,{formatter:t=null,...n}={}){return this.submitRequest("post",e,{formatter:t,...n})}submit(e=null,{formatter:t=null,...n}={}){if(e=e||this.paths.submit,!e)throw Error("No valid URL defined for submit method.");return this.submitRequest("post",e,{formatter:t,...n})}delete(e=null,{formatter:t=null,...n}={}){return this.submitRequest("delete",e,{formatter:t,...n})}put(e=null,{formatter:t=null,...n}={}){return this.submitRequest("put",e,{formatter:t,...n})}patch(e,{formatter:t=null,...n}={}){return this.submitRequest("patch",e,{formatter:t,...n})}submitRequest(e,t=null,{formatter:n=null,...i}={}){if(t&&typeof t!="string")throw new Error("Path must be a string");if(n!==null&&typeof n!="function")throw new Error("Formatter must be a function");this.abortController&&this.abortController.abort(),this.abortController=new AbortController,i.signal=this.abortController.signal,this.clearErrors(),this.submitting();const o=n?n(this.form):{...this.form};let a;return["get","delete"].includes(e)?(i.params=o,a=m[e](t,i)):a=m[e](t,o,i),a.then(l=>(this.abortController=null,this.clearErrors(),this.submitted(),l.data)).catch(l=>(l.name==="AbortError"?console.log("Request aborted:",l.message):(this.submitFailed(),this.errors.set(l,this.errorBag)),Promise.reject(l)))}clearErrors(){this.errors.clear(null,this.errorBag)}handleSubmissionFailure(e){this.submitFailed(),this.errors.set(e,this.errorBag)}async advancedSubmit(e){this.states.submit.loading();const{data:t}=await Promise.resolve(e(m,this.form)).catch(n=>{throw this.states.submit.failed(),this.errors.set(n,this.errorBag),n});return this.states.submit.loaded(),t}async load(e="",{updateLoading:t=!0,updateOriginal:n=!0,...i}={}){this.clearErrors(),this.states.load.loading();try{const{data:o}=await m.get(e||this.paths.load,i);return n&&Object.assign(this.original,o.form),Object.assign(this.form,o.form),o.model&&Object.assign(this.model,o.model),t&&this.loaded(),o}catch(o){throw this.states.load.failed(),o}}loading(){return this.states.load.loading(),this}loaded(){return this.states.load.loaded(),this}loadFailed(){return this.states.load.failed(),this}submitting(){return this.states.submit.loading(),this}submitFailed(){return this.states.submit.failed(),this}submitted(){return this.states.submit.loaded(),this}reset(){Object.assign(this.form,this.original)}resetOnly(e){if(!Array.isArray(e))throw new Error("The keys should be an array.");e.forEach(t=>{Object.prototype.hasOwnProperty.call(this.original,t)&&(this.form[t]=this.original[t])})}resetExcept(e){if(!Array.isArray(e))throw new Error("The keys should be an array.");Object.keys(this.form).forEach(t=>{console.log("key",t,!e.includes(t),this.original[t]),e.includes(t)||(this.form[t]=this.original[t])})}delay(e=0,t){clearTimeout(this.timeout),this.timeout=setTimeout(t,e)}toJson(){return JSON.parse(JSON.stringify(this.form))}}const Pe={name:"WyxosDatepicker",props:{modelValue:{required:!0,type:[null,String]},displayFormat:{type:String,default:"DD/MM/YYYY"},submitFormat:{type:String,default:"YYYY-MM-DD"},label:{type:String,default:null},name:{type:String,default:null},form:{type:w,default:null},options:{type:Object,default(){return{}}}},emits:["update:modelValue"],data(){return{query:null}},computed:{mergedOptions(){return{enableTimePicker:!1,autoApply:!0,...this.options}}},watch:{modelValue:{handler(r){this.query=r?_(r,this.submitFormat)._d:null},immediate:!0,deep:!0}},mounted(){this.modelValue&&(this.query=_(this.modelValue,this.submitFormat)._d)},methods:{dateFormatter(r){return r?_(r).format(this.displayFormat):null},updateQuery(){var r;this.$emit("update:modelValue",this.query?_(this.query).format(this.submitFormat):null),(r=this.form)==null||r.clearError(this.name)}}};function Re(r,e,t,n,i,o){var c;const a=s.resolveComponent("o-datepicker"),l=s.resolveComponent("o-field");return s.openBlock(),s.createBlock(l,s.mergeProps({label:t.label},(c=t.form)==null?void 0:c.getError(t.name)),{default:s.withCtx(()=>[s.createVNode(a,s.mergeProps({modelValue:i.query,"onUpdate:modelValue":e[0]||(e[0]=u=>i.query=u),"date-formatter":o.dateFormatter,"trap-focus":""},t.options,{"onUpdate:modelValue":o.updateQuery}),null,16,["modelValue","date-formatter","onUpdate:modelValue"])]),_:1},16,["label"])}const M=g(Pe,[["render",Re]]),Le=Object.freeze(Object.defineProperty({__proto__:null,default:M},Symbol.toStringTag,{value:"Module"})),We=s.defineComponent({name:"WyxosError",props:{form:{type:w,default:null},name:{type:String,required:!0}},setup(){return{errors:O()}}}),Ie={key:0},Ae={key:1};function De(r,e,t,n,i,o){var a,l;return(a=r.form)!=null&&a.getError(r.name).message?(s.openBlock(),s.createElementBlock("p",Ie,s.toDisplayString(r.form.getError(r.name).message),1)):(l=r.errors.get(r.name))!=null&&l.message?(s.openBlock(),s.createElementBlock("p",Ae,s.toDisplayString(r.errors.get(r.name).message),1)):s.createCommentVNode("",!0)}const z=g(We,[["render",De]]),Ue=Object.freeze(Object.defineProperty({__proto__:null,default:z},Symbol.toStringTag,{value:"Module"})),Y="%[a-f0-9]{2}",J=new RegExp("("+Y+")|([^%]+?)","gi"),H=new RegExp("("+Y+")+","gi");function N(r,e){try{return[decodeURIComponent(r.join(""))]}catch{}if(r.length===1)return r;e=e||1;const t=r.slice(0,e),n=r.slice(e);return Array.prototype.concat.call([],N(t),N(n))}function Me(r){try{return decodeURIComponent(r)}catch{let e=r.match(J)||[];for(let t=1;t<e.length;t++)r=N(e,t).join(""),e=r.match(J)||[];return r}}function ze(r){const e={"%FE%FF":"��","%FF%FE":"��"};let t=H.exec(r);for(;t;){try{e[t[0]]=decodeURIComponent(t[0])}catch{const i=Me(t[0]);i!==t[0]&&(e[t[0]]=i)}t=H.exec(r)}e["%C2"]="�";const n=Object.keys(e);for(const i of n)r=r.replace(new RegExp(i,"g"),e[i]);return r}function Ye(r){if(typeof r!="string")throw new TypeError("Expected `encodedURI` to be of type `string`, got `"+typeof r+"`");try{return decodeURIComponent(r)}catch{return ze(r)}}function K(r,e){if(!(typeof r=="string"&&typeof e=="string"))throw new TypeError("Expected the arguments to be of type `string`");if(r===""||e==="")return[];const t=r.indexOf(e);return t===-1?[]:[r.slice(0,t),r.slice(t+e.length)]}function Je(r,e){const t={};if(Array.isArray(e))for(const n of e){const i=Object.getOwnPropertyDescriptor(r,n);i!=null&&i.enumerable&&Object.defineProperty(t,n,i)}else for(const n of Reflect.ownKeys(r)){const i=Object.getOwnPropertyDescriptor(r,n);if(i.enumerable){const o=r[n];e(n,o,r)&&Object.defineProperty(t,n,i)}}return t}const He=r=>r==null,Ke=r=>encodeURIComponent(r).replace(/[!'()*]/g,e=>`%${e.charCodeAt(0).toString(16).toUpperCase()}`),B=Symbol("encodeFragmentIdentifier");function Qe(r){switch(r.arrayFormat){case"index":return e=>(t,n)=>{const i=t.length;return n===void 0||r.skipNull&&n===null||r.skipEmptyString&&n===""?t:n===null?[...t,[f(e,r),"[",i,"]"].join("")]:[...t,[f(e,r),"[",f(i,r),"]=",f(n,r)].join("")]};case"bracket":return e=>(t,n)=>n===void 0||r.skipNull&&n===null||r.skipEmptyString&&n===""?t:n===null?[...t,[f(e,r),"[]"].join("")]:[...t,[f(e,r),"[]=",f(n,r)].join("")];case"colon-list-separator":return e=>(t,n)=>n===void 0||r.skipNull&&n===null||r.skipEmptyString&&n===""?t:n===null?[...t,[f(e,r),":list="].join("")]:[...t,[f(e,r),":list=",f(n,r)].join("")];case"comma":case"separator":case"bracket-separator":{const e=r.arrayFormat==="bracket-separator"?"[]=":"=";return t=>(n,i)=>i===void 0||r.skipNull&&i===null||r.skipEmptyString&&i===""?n:(i=i===null?"":i,n.length===0?[[f(t,r),e,f(i,r)].join("")]:[[n,f(i,r)].join(r.arrayFormatSeparator)])}default:return e=>(t,n)=>n===void 0||r.skipNull&&n===null||r.skipEmptyString&&n===""?t:n===null?[...t,f(e,r)]:[...t,[f(e,r),"=",f(n,r)].join("")]}}function Xe(r){let e;switch(r.arrayFormat){case"index":return(t,n,i)=>{if(e=/\[(\d*)]$/.exec(t),t=t.replace(/\[\d*]$/,""),!e){i[t]=n;return}i[t]===void 0&&(i[t]={}),i[t][e[1]]=n};case"bracket":return(t,n,i)=>{if(e=/(\[])$/.exec(t),t=t.replace(/\[]$/,""),!e){i[t]=n;return}if(i[t]===void 0){i[t]=[n];return}i[t]=[...i[t],n]};case"colon-list-separator":return(t,n,i)=>{if(e=/(:list)$/.exec(t),t=t.replace(/:list$/,""),!e){i[t]=n;return}if(i[t]===void 0){i[t]=[n];return}i[t]=[...i[t],n]};case"comma":case"separator":return(t,n,i)=>{const o=typeof n=="string"&&n.includes(r.arrayFormatSeparator),a=typeof n=="string"&&!o&&C(n,r).includes(r.arrayFormatSeparator);n=a?C(n,r):n;const l=o||a?n.split(r.arrayFormatSeparator).map(c=>C(c,r)):n===null?n:C(n,r);i[t]=l};case"bracket-separator":return(t,n,i)=>{const o=/(\[])$/.test(t);if(t=t.replace(/\[]$/,""),!o){i[t]=n&&C(n,r);return}const a=n===null?[]:n.split(r.arrayFormatSeparator).map(l=>C(l,r));if(i[t]===void 0){i[t]=a;return}i[t]=[...i[t],...a]};default:return(t,n,i)=>{if(i[t]===void 0){i[t]=n;return}i[t]=[...[i[t]].flat(),n]}}}function Q(r){if(typeof r!="string"||r.length!==1)throw new TypeError("arrayFormatSeparator must be single character string")}function f(r,e){return e.encode?e.strict?Ke(r):encodeURIComponent(r):r}function C(r,e){return e.decode?Ye(r):r}function X(r){return Array.isArray(r)?r.sort():typeof r=="object"?X(Object.keys(r)).sort((e,t)=>Number(e)-Number(t)).map(e=>r[e]):r}function G(r){const e=r.indexOf("#");return e!==-1&&(r=r.slice(0,e)),r}function Ge(r){let e="";const t=r.indexOf("#");return t!==-1&&(e=r.slice(t)),e}function Z(r,e){return e.parseNumbers&&!Number.isNaN(Number(r))&&typeof r=="string"&&r.trim()!==""?r=Number(r):e.parseBooleans&&r!==null&&(r.toLowerCase()==="true"||r.toLowerCase()==="false")&&(r=r.toLowerCase()==="true"),r}function j(r){r=G(r);const e=r.indexOf("?");return e===-1?"":r.slice(e+1)}function $(r,e){e={decode:!0,sort:!0,arrayFormat:"none",arrayFormatSeparator:",",parseNumbers:!1,parseBooleans:!1,...e},Q(e.arrayFormatSeparator);const t=Xe(e),n=Object.create(null);if(typeof r!="string"||(r=r.trim().replace(/^[?#&]/,""),!r))return n;for(const i of r.split("&")){if(i==="")continue;const o=e.decode?i.replace(/\+/g," "):i;let[a,l]=K(o,"=");a===void 0&&(a=o),l=l===void 0?null:["comma","separator","bracket-separator"].includes(e.arrayFormat)?l:C(l,e),t(C(a,e),l,n)}for(const[i,o]of Object.entries(n))if(typeof o=="object"&&o!==null)for(const[a,l]of Object.entries(o))o[a]=Z(l,e);else n[i]=Z(o,e);return e.sort===!1?n:(e.sort===!0?Object.keys(n).sort():Object.keys(n).sort(e.sort)).reduce((i,o)=>{const a=n[o];return i[o]=a&&typeof a=="object"&&!Array.isArray(a)?X(a):a,i},Object.create(null))}function v(r,e){if(!r)return"";e={encode:!0,strict:!0,arrayFormat:"none",arrayFormatSeparator:",",...e},Q(e.arrayFormatSeparator);const t=a=>e.skipNull&&He(r[a])||e.skipEmptyString&&r[a]==="",n=Qe(e),i={};for(const[a,l]of Object.entries(r))t(a)||(i[a]=l);const o=Object.keys(i);return e.sort!==!1&&o.sort(e.sort),o.map(a=>{const l=r[a];return l===void 0?"":l===null?f(a,e):Array.isArray(l)?l.length===0&&e.arrayFormat==="bracket-separator"?f(a,e)+"[]":l.reduce(n(a),[]).join("&"):f(a,e)+"="+f(l,e)}).filter(a=>a.length>0).join("&")}function ee(r,e){var i;e={decode:!0,...e};let[t,n]=K(r,"#");return t===void 0&&(t=r),{url:((i=t==null?void 0:t.split("?"))==null?void 0:i[0])??"",query:$(j(r),e),...e&&e.parseFragmentIdentifier&&n?{fragmentIdentifier:C(n,e)}:{}}}function te(r,e){e={encode:!0,strict:!0,[B]:!0,...e};const t=G(r.url).split("?")[0]||"",n=j(r.url),i={...$(n,{sort:!1}),...r.query};let o=v(i,e);o&&(o=`?${o}`);let a=Ge(r.url);if(r.fragmentIdentifier){const l=new URL(t);l.hash=r.fragmentIdentifier,a=e[B]?l.hash:`#${r.fragmentIdentifier}`}return`${t}${o}${a}`}function re(r,e,t){t={parseFragmentIdentifier:!0,[B]:!1,...t};const{url:n,query:i,fragmentIdentifier:o}=ee(r,t);return te({url:n,query:Je(i,e),fragmentIdentifier:o},t)}function Ze(r,e,t){const n=Array.isArray(e)?i=>!e.includes(i):(i,o)=>!e(i,o);return re(r,n,t)}const se=Object.freeze(Object.defineProperty({__proto__:null,exclude:Ze,extract:j,parse:$,parseUrl:ee,pick:re,stringify:v,stringifyUrl:te},Symbol.toStringTag,{value:"Module"}));let q=null;class E{constructor(){h(this,"cancelTokenSource",null);h(this,"api",null);h(this,"baseUrl",null);h(this,"structure",null);h(this,"options",null);h(this,"errors",null);h(this,"errorBag","listing");h(this,"globalCancel",!0);h(this,"attributes",s.reactive({query:{items:[],showing:0,perPage:0,total:0},params:{page:1},state:{list:null,filter:null}}));return new Proxy(this,{get(e,t,n){if(Reflect.has(e,t))return Reflect.get(e,t,n);if(Reflect.has(e.attributes,t)){const i=t.split(".");if(i.length>1){let o=e.attributes;for(let a=0;a<i.length;a++)o=o[i[a]];return o??void 0}return Reflect.get(e.attributes,t)}},set(e,t,n,i){if(Reflect.has(e,t))return Reflect.set(e,t,n,i);if(Reflect.has(e.attributes,t)){const o=t.split(".");if(o.length>1){let a=e.form;for(let l=0;l<o.length-1;l++)o[l]in a||(a[o[l]]={}),a=a[o[l]];return a[o[o.length-1]]===void 0?!1:(a[o[o.length-1]]=n,!0)}return Reflect.set(e.attributes,t,n)}return!1}})}get config(){return{data:this.attributes.query.items,total:this.attributes.query.total,currentPage:this.attributes.params.page,perPage:this.attributes.query.perPage,loading:this.isLoading,paginated:!0,backendPagination:!0,striped:!0}}get events(){return{pageChange:e=>this.onPageChange(e)}}get isFilterActive(){return this.attributes.state.filter}get isEmpty(){return this.isLoaded&&this.attributes.query.items.length===0}get isDirty(){return JSON.stringify(this.structure)!==JSON.stringify(this.attributes.params)}get isSearchEmpty(){return this.isLoaded&&this.isDirty&&this.attributes.query.items.length===0}get isResettable(){return JSON.stringify(this.attributes.params)!==JSON.stringify(this.structure)}get isLoaded(){return this.attributes.state.list==="loaded"}get isLoading(){return this.attributes.state.list==="loading"}get isFailure(){return this.attributes.state.list==="failed"}static create(e={},t={}){const n=new E;return n.errors=O(),n.errors.createBag(n.errorBag),n.options=Object.assign({enableSearchUpdate:!0,transformItem:i=>i},t),n.setParameters(e),n.options.enableSearchUpdate&&n.mergeSearch(),n.baseUrl=t.baseUrl,n}setUrl(e){return this.baseUrl=e,this}setRouterInstance(e){return this.options.router=e,this}setParameters(e){const t=JSON.parse(JSON.stringify(e));this.structure=Object.assign({},t),this.attributes.params=s.reactive(e)}mergeSearch(){const e=se.parse(window.location.search,{arrayFormat:"bracket",parseNumbers:!0});e.page&&(e.page=Number(e.page)),Object.assign(this.attributes.params,this.structure,e)}async fetch(e,t){const n=JSON.parse(JSON.stringify(this.attributes.params)),i=e||this.baseUrl,{data:o}=await m.get(i,{params:n,cancelToken:t});return o}async reload(e){const{data:t}=await m.get(e||this.baseUrl,{params:JSON.parse(JSON.stringify(this.attributes.params))});return Object.assign(this.attributes.query,t.query,{items:t.query.items.map(n=>this.transformItem(n))}),t}refreshUrl(){const e=window.location.href.replace(/\?.*/,""),t=JSON.parse(JSON.stringify(this.attributes.params)),n=Object.fromEntries(Object.entries(t).filter(([o,a])=>a!=null)),i=e+"?"+se.stringify(n,{arrayFormat:"bracket"});if(this.options.router){const o=this.options.router.currentRoute.path;this.options.router.push({path:o,query:{...this.options.router.currentRoute.query,...t}})}else window.history.pushState({},"",i)}push(e){this.attributes.query.items.push(this.transformItem(e))}transformItem(e){return this.options.transformItem({...e,states:{delete:new y,patch:new y}})}async load(e){this.errors.clear(null,this.errorBag),this.globalCancel?(q&&q.cancel(),q=m.CancelToken.source()):(this.cancelTokenSource&&this.cancelTokenSource.cancel(),this.cancelTokenSource=m.CancelToken.source()),this.loading(),this.attributes.query.items=[],this.attributes.query.total=0,this.attributes.query.showing=0;let t=null;try{const n=JSON.parse(JSON.stringify(this.attributes.params)),i=e||this.baseUrl;if(t=(await m.get(i,{params:n,cancelToken:this.globalCancel?q.token:this.cancelTokenSource.token}).catch(a=>{throw this.failed(),a})).data,!t||!t.query||!t.query.items)throw this.failed(),Error("Response format is invalid.");return this.loaded(),Object.assign(this.attributes.query,t.query,{items:t.query.items.map(a=>this.transformItem(a))}),t}catch(n){if(m.isCancel(n))this.loaded(),console.error("Request cancelled");else throw this.failed(),this.errors.set(n,this.errorBag),n}}onPageChange(e){return this.attributes.params.page=e,this.options.router?Promise.resolve().then(()=>{this.refreshUrl()}):this.load().then(()=>{this.refreshUrl()})}onQueryUpdate(e,t,n){e.path===t.path&&e.fullPath!==t.fullPath&&this.load(),n()}async patch({path:e,props:t,payload:n}={}){const{row:i}=t;n={id:i.id,...n};const{data:o}=await m.patch(e||this.baseUrl,n).catch(l=>{throw l});return o.patch&&Object.assign(i,o.patch),(await this.fetch()).query.items.length||(this.attributes.params.page--,await this.load()),o}async destroy(e,{props:t,data:n,config:i,method:o="delete"}){let a;const{index:l,row:c}=t;c.isProcessing=!0,o==="delete"?a=await m.delete(e,i):o==="post"&&(a=await m.post(e,n,i));const u=await this.fetch();if(u.query.items.find(p=>p.id===c.id))return c.isProcessing=!1,a.data;this.attributes.query.items.splice(l,1);const b=this.attributes.query.items.map(p=>p.id);return u.query.items.filter(p=>!b.includes(p.id)).forEach(p=>this.attributes.query.items.push(p)),a.data}async update(e,{props:t,data:n,config:i,method:o="patch"}){let a;const{index:l,row:c}=t;c.isProcessing=!0,o==="patch"?a=await m.patch(e,i):o==="post"&&(a=await m.post(e,n,i));const u=await this.fetch(),S=u.query.items.find(p=>p.id===c.id);if(S)return c.isProcessing=!1,Object.assign(c,S),a.data;this.attributes.query.items.splice(l,1);const b=this.attributes.query.items.map(p=>p.id);return u.query.items.filter(p=>!b.includes(p.id)).forEach(p=>this.attributes.query.items.push(p)),a.data}async delete(e){return this.processRowAndRefreshList({...e,method:"delete",state:"delete"})}async restore(e){return this.processRowAndRefreshList({...e,method:"patch",state:"restore"})}async processRowAndRefreshList({path:e,props:t,payload:n,state:i,method:o}={}){const{row:a,index:l}=t;n={id:a.id,...n};let c=a.states[i];c||(c=a.states[i]=y.create()),c.loading();const{data:u}=await m[o](e||this.baseUrl,n).catch(b=>{throw c.failed(),b});c.loaded(),u.row&&Object.assign(a,u.row);const S=await this.fetch();if(this.attributes.query.items.splice(l,1),!S.query.items.length)return this.attributes.params.page--,await this.load(),u;if(this.attributes.query.items.length<S.query.items.length){const b=S.query.items[S.query.items.length-1];this.push(b)}return u}async applyFilter(){this.errors.clear(null,this.errorBag),this.cancelTokenSource&&this.cancelTokenSource.cancel(),this.loading(),this.cancelTokenSource=m.CancelToken.source(),this.attributes.query.items=[],this.attributes.params.page=1,this.attributes.query.total=0,this.attributes.query.showing=0;let e=null;try{const t=JSON.parse(JSON.stringify(this.attributes.params)),n=this.baseUrl;e=(await m.get(n,{params:t,cancelToken:this.cancelTokenSource.token}).catch(o=>{throw this.failed(),o})).data}catch(t){if(m.isCancel(t)){console.error("Request cancelled");return}else throw this.failed(),this.errors.set(t,this.errorBag),t}if(this.refreshUrl(),!e||!e.query||!e.query.items)throw this.failed(),Error("Response format is invalid.");Object.assign(this.attributes.query,e.query,{items:e.query.items.map(t=>this.transformItem(t))}),await s.nextTick(),this.loaded(),this.hideFilter()}showFilter(){this.attributes.state.filter=!0}hideFilter(){this.attributes.state.filter=!1}cancelFilter(){this.mergeSearch(),this.attributes.state.filter=!1}resetFilter(e=null){return Object.assign(this.attributes.params,this.structure),this.refreshUrl(),this.attributes.state.filter=!1,this.load(e)}getError(e){return this.errors.get(e,this.errorBag)}clearError(e){this.errors.clear(e,this.errorBag)}loaded(){this.attributes.state.list="loaded"}loading(){this.attributes.state.list="loading"}failed(){this.attributes.state.list="failed"}}const ve={name:"WyxosForm",props:{form:{type:w,required:!0},submit:{type:[Function,Promise],default:null},listing:{type:E,default:null},reset:{type:[Boolean,Function],default:!1},formClass:{type:[String,Array,Object],default:null}},emits:["submitted"],methods:{async handle(){if(this.submit?await this.submit(this.form):await this.form.submit(),this.reset&&(typeof this.reset=="function"?this.reset():this.form.reset()),this.$emit("submitted"),this.listing)return this.listing.reload()}}};function et(r,e,t,n,i,o){const a=s.resolveComponent("o-loading"),l=s.resolveComponent("o-button");return t.form.isLoaded?(s.openBlock(),s.createElementBlock("form",{key:0,class:s.normalizeClass(t.formClass),onSubmit:e[0]||(e[0]=s.withModifiers(c=>o.handle(),["prevent"]))},[s.renderSlot(r.$slots,"default")],34)):t.form.isLoading?(s.openBlock(),s.createBlock(a,{key:1,active:!0})):t.form.isFailure?(s.openBlock(),s.createBlock(l,{key:2,onClick:e[1]||(e[1]=c=>t.form.load())},{default:s.withCtx(()=>[s.createTextVNode(" Error. Retry or refresh. ")]),_:1})):s.createCommentVNode("",!0)}const ne=g(ve,[["render",et]]),tt=Object.freeze(Object.defineProperty({__proto__:null,default:ne},Symbol.toStringTag,{value:"Module"})),rt={name:"WyxosImage",props:{src:{type:[File,String],required:!0},resize:{type:Object,default:null}},emits:["loaded"],data(){return{instance:null,width:0,height:0}},mounted(){this.loadImage()},unmounted(){this.instance.onload=null},methods:{loadImage(){return typeof this.src=="object"?this.loadFile():this.loadPath()},loadFile(){this.instance=new FileReader,this.instance.onload=r=>{const e=r.target.result;this.$refs.image.src=e,this.width=this.resize?this.resize.width:e.width,this.height=this.resize?this.resize.height:e.height,this.$emit("loaded")},this.instance.readAsDataURL(this.src)},loadPath(){this.instance=new Image,this.instance.onload=()=>{this.$refs.image.src=this.src,this.width=this.resize?this.resize.width:this.instance.width,this.height=this.resize?this.resize.height:this.instance.height,this.$emit("loaded")},this.instance.src=this.src}}},st=["width","height"];function nt(r,e,t,n,i,o){return s.openBlock(),s.createElementBlock("img",{ref:"image",src:"",alt:"",width:i.width,height:i.height},null,8,st)}const ie=g(rt,[["render",nt]]),it=Object.freeze(Object.defineProperty({__proto__:null,default:ie},Symbol.toStringTag,{value:"Module"})),ot={name:"WyxosInput",props:{label:{type:String,default:""},readonly:{type:Boolean,default:!1},name:{type:String,required:!0},bag:{type:String,default:()=>"default"},type:{type:String,default:"text"},clearable:{type:Boolean,default:!1},fieldClass:{type:String,default:null},inputRootClass:{type:String,default:null},inputClass:{type:String,default:null},modelValue:{type:[String,Number,null],default:null},form:{type:w,default:null},disabled:{type:[Boolean,String],default:null},placeholder:{type:String,default:null},passwordReveal:{type:Boolean,default:!1}},emits:["update:modelValue"],setup(){return{errors:O()}},computed:{getError(){if(this.name)return this.form?this.form.getError(this.name):this.errors.get(this.name,this.bag)}},methods:{onInput(r){this.form?this.form.clearError(this.name):this.errors.clear(this.name,this.bag),this.$emit("update:modelValue",r)}}};function at(r,e,t,n,i,o){const a=s.resolveComponent("o-input"),l=s.resolveComponent("o-field");return s.openBlock(),s.createBlock(l,s.mergeProps({class:t.fieldClass,label:t.label},o.getError),{default:s.withCtx(()=>[s.createVNode(a,{class:s.normalizeClass(t.inputClass),clearable:t.clearable,disabled:t.disabled,"model-value":t.modelValue,name:t.name,"password-reveal":t.passwordReveal,placeholder:t.placeholder,readonly:t.readonly,"root-class":t.inputRootClass,type:t.type,"onUpdate:modelValue":e[0]||(e[0]=c=>o.onInput(c))},null,8,["class","clearable","disabled","model-value","name","password-reveal","placeholder","readonly","root-class","type"])]),_:1},16,["class","label"])}const oe=g(ot,[["render",at]]),lt=Object.freeze(Object.defineProperty({__proto__:null,default:oe},Symbol.toStringTag,{value:"Module"})),ct={name:"WyxosListing",props:{listing:{type:E,required:!0}},computed:{allPropsAndEvents(){return{...this.listing.config,...Object.keys(this.listing.events).reduce((r,e)=>(r[`on${e.charAt(0).toUpperCase()+e.slice(1)}`]=this.listing.events[e],r),{})}}}},dt={key:0},ut={key:1},ht={key:2};function mt(r,e,t,n,i,o){const a=s.resolveComponent("o-table");return s.openBlock(),s.createBlock(a,s.normalizeProps(s.guardReactiveProps(o.allPropsAndEvents)),s.createSlots({empty:s.withCtx(()=>[t.listing.isEmpty?(s.openBlock(),s.createElementBlock("p",dt,"No records found.")):s.createCommentVNode("",!0),t.listing.isSearchEmpty?(s.openBlock(),s.createElementBlock("p",ut," No results for your query. Please adjust your search and try again. ")):s.createCommentVNode("",!0),t.listing.isFailure?(s.openBlock(),s.createElementBlock("p",ht," Failure to load the list. Try again or reload the page. ")):s.createCommentVNode("",!0)]),_:2},[s.renderList(r.$slots,(l,c)=>({name:c,fn:s.withCtx(u=>[s.renderSlot(r.$slots,c,s.normalizeProps(s.guardReactiveProps(u)))])}))]),1040)}const ae=g(ct,[["render",mt]]),ft=Object.freeze(Object.defineProperty({__proto__:null,default:ae},Symbol.toStringTag,{value:"Module"})),gt={name:"WyxosLiveInput",props:{label:{type:String,default:""},readonly:{type:Boolean,default:!1},name:{type:String,required:!0},bag:{type:String,default:()=>"default"},type:{type:String,default:"text"},clearable:{type:Boolean,default:!1},fieldClass:{type:String,default:null},inputRootClass:{type:String,default:null},inputClass:{type:String,default:null},modelValue:{type:[String,Number,null],default:null},form:{type:w,default:null},disabled:{type:[Boolean,String],default:null},placeholder:{type:String,default:null}},emits:["update:modelValue"],setup(){return{errors:O()}},methods:{onInput(r){if(!this.name){this.$emit("update:modelValue",r);return}if(this.form)return this.form.clearError(this.name),this.form.submit(null,{formatter:()=>({field:this.name,value:r})});this.errors.clear(this.name,this.bag),this.$emit("update:modelValue",r)},getError(){if(this.name)return this.form?this.form.getError(this.name):this.errors.get(this.name)}}};function pt(r,e,t,n,i,o){const a=s.resolveComponent("o-input"),l=s.resolveComponent("o-field");return s.openBlock(),s.createBlock(l,s.mergeProps({label:t.label,class:t.fieldClass},{...o.getError()}),{default:s.withCtx(()=>[s.createVNode(a,{readonly:t.readonly,class:s.normalizeClass(t.inputClass),"root-class":t.inputRootClass,name:t.name,type:t.type,clearable:t.clearable,disabled:t.disabled,"model-value":t.modelValue,placeholder:t.placeholder,"onUpdate:modelValue":e[0]||(e[0]=c=>o.onInput(c))},null,8,["readonly","class","root-class","name","type","clearable","disabled","model-value","placeholder"])]),_:1},16,["label","class"])}const le=g(gt,[["render",pt]]),yt=Object.freeze(Object.defineProperty({__proto__:null,default:le},Symbol.toStringTag,{value:"Module"})),bt={name:"WyxosLogout",props:{path:{type:String,default:"/logout"}},methods:{async logout(){const{data:r}=await m.post(this.path).catch(e=>{throw e.response.status===401&&(window.location.href="/"),e});window.location.href=(r==null?void 0:r.redirect)||"/"}}};function _t(r,e,t,n,i,o){return s.renderSlot(r.$slots,"default",{logout:o.logout},()=>[s.createElementVNode("button",{class:"button is-primary",onClick:e[0]||(e[0]=a=>o.logout())},"Sign out")])}const ce=g(bt,[["render",_t]]),St=Object.freeze(Object.defineProperty({__proto__:null,default:ce},Symbol.toStringTag,{value:"Module"})),wt=s.defineComponent({name:"WyxosProgress",props:{showValue:{type:Boolean,default:!0},value:{type:Number,required:!0},max:{type:Number,required:!0},format:{type:String,default:"percent"}}}),Ct=["value","max"],Vt={key:0};function Ot(r,e,t,n,i,o){return s.openBlock(),s.createElementBlock(s.Fragment,null,[s.createElementVNode("progress",{value:r.value,max:r.max},null,8,Ct),r.showValue?(s.openBlock(),s.createElementBlock("span",Vt,s.toDisplayString(r.value)+" / "+s.toDisplayString(r.max),1)):s.createCommentVNode("",!0)],64)}const de=g(wt,[["render",Ot]]),Et=Object.freeze(Object.defineProperty({__proto__:null,default:de},Symbol.toStringTag,{value:"Module"})),Ft={name:"WyxosPrompt",props:{title:{type:String,default:null},message:{type:String,default:null},confirmText:{type:String,default:null},cancelText:{type:String,default:null},loading:{type:Boolean,default:!1},callback:{type:Function,default:null}},emits:["close"],setup(){return{state:new y}},methods:{async proceed(){this.callback&&(this.state.loading(),await this.callback().catch(r=>{throw this.state.failed(),r}),this.state.loaded()),this.$emit("close",{action:!0})}}},kt={class:"flex gap-6"};function qt(r,e,t,n,i,o){const a=s.resolveComponent("wyxos-button"),l=s.resolveComponent("o-modal");return s.openBlock(),s.createBlock(l,{active:!0,onBlur:e[2]||(e[2]=c=>r.$emit("close",{action:!1}))},{default:s.withCtx(()=>[s.createElementVNode("h2",null,s.toDisplayString(t.title),1),s.createElementVNode("p",null,s.toDisplayString(t.message),1),s.createElementVNode("div",kt,[s.createVNode(a,{disabled:n.state.isLoading,class:"button is-danger","native-type":"button",onClick:e[0]||(e[0]=c=>r.$emit("close",{action:!1}))},{default:s.withCtx(()=>[s.createTextVNode(s.toDisplayString(t.cancelText),1)]),_:1},8,["disabled"]),s.createVNode(a,{loading:n.state.isLoading,class:"button","native-type":"button",onClick:e[1]||(e[1]=c=>o.proceed())},{default:s.withCtx(()=>[s.createTextVNode(s.toDisplayString(t.confirmText),1)]),_:1},8,["loading"])])]),_:1})}const T=g(Ft,[["render",qt]]),xt=Object.freeze(Object.defineProperty({__proto__:null,default:T},Symbol.toStringTag,{value:"Module"})),Nt={name:"WyxosRemove",props:{listing:{type:E,default:null},route:{type:String,required:!0}},emits:["removed","failed"],setup(){return{destroy:w.create()}},data(){return{isVisible:!1}},methods:{async onRemove(){this.isVisible=!0},remove(){this.destroy.delete(this.route).then(()=>{this.$emit("removed"),this.listing&&this.listing.reload(),this.isVisible=!1}).catch(()=>{this.$emit("failed")})}}},Bt=s.createElementVNode("i",{class:"fas fa-trash"},null,-1),jt={class:"content p-6"},$t=s.createElementVNode("h3",{class:"title"},"Delete",-1),Tt=s.createElementVNode("p",{class:"mb-4"}," Are you sure you want to delete this record? ",-1),Pt={class:"buttons flex gap-6 justify-end"};function Rt(r,e,t,n,i,o){const a=s.resolveComponent("o-button"),l=s.resolveComponent("w-button"),c=s.resolveComponent("o-modal");return s.openBlock(),s.createBlock(l,{class:"button is-danger",onClick:e[3]||(e[3]=u=>o.onRemove())},{default:s.withCtx(()=>[s.renderSlot(r.$slots,"button",{},()=>[Bt]),i.isVisible?(s.openBlock(),s.createBlock(s.Teleport,{key:0,to:"body"},[s.createVNode(c,{active:i.isVisible,"onUpdate:active":e[2]||(e[2]=u=>i.isVisible=u)},{default:s.withCtx(()=>[s.createElementVNode("div",jt,[s.renderSlot(r.$slots,"title",{},()=>[$t]),s.renderSlot(r.$slots,"message",{},()=>[Tt]),s.createElementVNode("div",Pt,[s.createVNode(a,{class:"button is-secondary",onClick:e[0]||(e[0]=u=>i.isVisible=!1)},{default:s.withCtx(()=>[s.createTextVNode("Cancel ")]),_:1}),s.createVNode(l,{loading:n.destroy.isSubmitting,class:"button is-danger",onClick:e[1]||(e[1]=u=>o.remove())},{default:s.withCtx(()=>[s.renderSlot(r.$slots,"confirm",{},()=>[s.createTextVNode("Confirm")])]),_:3},8,["loading"])])])]),_:3},8,["active"])])):s.createCommentVNode("",!0)]),_:3})}const ue=g(Nt,[["render",Rt]]),Lt=Object.freeze(Object.defineProperty({__proto__:null,default:ue},Symbol.toStringTag,{value:"Module"})),Wt={name:"WyxosSelect",props:{label:{type:String,default:null},placeholder:{type:String,default:null},disabled:{type:Boolean,default:null},name:{type:String,default:null},modelValue:{type:[null,String,Number],required:!0},form:{type:w,default:null},items:{type:Array,default:null}},emits:["update:modelValue"],methods:{updateValue(r){var e;(e=this.form)==null||e.clearError(this.name),this.$emit("update:modelValue",r)}}},It=["value"];function At(r,e,t,n,i,o){var c;const a=s.resolveComponent("o-select"),l=s.resolveComponent("o-field");return s.openBlock(),s.createBlock(l,s.mergeProps({label:t.label},(c=t.form)==null?void 0:c.getError(t.name)),{default:s.withCtx(()=>[s.createVNode(a,{disabled:t.disabled,"model-value":t.modelValue,name:t.name,placeholder:t.placeholder,"root-class":"w-full","select-class":"w-full","onUpdate:modelValue":e[0]||(e[0]=u=>o.updateValue(u))},{default:s.withCtx(()=>[s.renderSlot(r.$slots,"default",{},()=>[t.items?(s.openBlock(!0),s.createElementBlock(s.Fragment,{key:0},s.renderList(t.items,u=>(s.openBlock(),s.createElementBlock("option",{key:u.value,value:u.value},s.toDisplayString(u.label),9,It))),128)):s.createCommentVNode("",!0)])]),_:3},8,["disabled","model-value","name","placeholder"])]),_:3},16,["label"])}const he=g(Wt,[["render",At]]),Dt=Object.freeze(Object.defineProperty({__proto__:null,default:he},Symbol.toStringTag,{value:"Module"})),Ut={name:"WyxosSessionExpired",emits:["close"],setup(){return{login:w.create({email:null,password:null})}},data(){return{user:null,propertiesCount:0,organisations:[]}},methods:{async proceed(){await this.login.submit("/login"),this.$emit("close",{action:!0})},onLogout(){window.location.href="/"}}},Mt={class:"bg-white p-6"},zt=s.createElementVNode("h2",{class:"title"},"Session Expired",-1),Yt=s.createElementVNode("p",{class:"mb-6"}," It looks like you've been away for a bit. For your security, please re-enter your credentials to continue. ",-1),Jt={class:"buttons"};function Ht(r,e,t,n,i,o){const a=s.resolveComponent("wyxos-input"),l=s.resolveComponent("w-button"),c=s.resolveComponent("o-modal");return s.openBlock(),s.createBlock(c,{active:!0},{default:s.withCtx(()=>[s.createElementVNode("div",Mt,[zt,Yt,s.createElementVNode("form",{onSubmit:e[3]||(e[3]=s.withModifiers((...u)=>o.proceed&&o.proceed(...u),["prevent"]))},[s.createVNode(a,{modelValue:n.login.email,"onUpdate:modelValue":e[0]||(e[0]=u=>n.login.email=u),name:"email",label:"Email"},null,8,["modelValue"]),s.createVNode(a,{modelValue:n.login.password,"onUpdate:modelValue":e[1]||(e[1]=u=>n.login.password=u),name:"password",label:"Password",type:"password"},null,8,["modelValue"]),s.createElementVNode("div",Jt,[s.createVNode(l,{class:"button is-danger",disabled:n.login.isSubmitting,onClick:e[2]||(e[2]=u=>o.onLogout())},{default:s.withCtx(()=>[s.createTextVNode(" Logout ")]),_:1},8,["disabled"]),s.createVNode(l,{class:"button is-primary","native-type":"submit",loading:n.login.isSubmitting},{default:s.withCtx(()=>[s.createTextVNode(" Login ")]),_:1},8,["loading"])])],32)])]),_:1})}const P=g(Ut,[["render",Ht]]),Kt=Object.freeze(Object.defineProperty({__proto__:null,default:P},Symbol.toStringTag,{value:"Module"})),Qt={name:"WyxosSubmit",props:{form:{type:w,required:!0},labels:{type:Object,default(){return{submit:"Submit",submitting:"Processing",submitted:"Complete",failed:"Retry"}}}},data(){return{mergedLabels:{submit:"Submit",submitting:"Processing",submitted:"Complete",failed:"Retry"}}},watch:{labels:{deep:!0,handler(r){this.mergedLabels={...this.mergedLabels,...r}}}},created(){this.mergedLabels={...this.mergedLabels,...this.labels}}},Xt={key:0},Gt={key:1},Zt=s.createElementVNode("i",{class:"fas fa-spinner fa-spin"},null,-1),vt={key:2},er={key:3};function tr(r,e,t,n,i,o){const a=s.resolveComponent("o-button");return s.openBlock(),s.createBlock(a,{disabled:!!(t.form.isSubmitting||t.form.isSubmitted),"native-type":"submit"},{default:s.withCtx(()=>[!t.form.isSubmitted&&!t.form.isSubmitting&&!t.form.isSubmitFailed?(s.openBlock(),s.createElementBlock("span",Xt,s.toDisplayString(i.mergedLabels.submit),1)):s.createCommentVNode("",!0),t.form.isSubmitting?(s.openBlock(),s.createElementBlock("span",Gt,[s.createTextVNode(s.toDisplayString(i.mergedLabels.submitting)+" ",1),Zt])):s.createCommentVNode("",!0),t.form.isSubmitted?(s.openBlock(),s.createElementBlock("span",vt,s.toDisplayString(i.mergedLabels.submitted),1)):s.createCommentVNode("",!0),t.form.isSubmitFailed?(s.openBlock(),s.createElementBlock("span",er,s.toDisplayString(i.mergedLabels.failed),1)):s.createCommentVNode("",!0)]),_:1},8,["disabled"])}const me=g(Qt,[["render",tr]]),rr=Object.freeze(Object.defineProperty({__proto__:null,default:me},Symbol.toStringTag,{value:"Module"}));class x{constructor(e={}){h(this,"state",new y);h(this,"result",s.ref([]));h(this,"value",s.ref(null));h(this,"timeout",null);h(this,"options",{url:null,payload:null,field:null});Object.assign(this.options,e)}get getConfig(){return{data:this.result.value,field:this.options.field,modelValue:this.value.value}}static create(e){return new x(e)}getEvents({searchPayloadFormatter:e=null}={}){return{"update:model-value":t=>(this.value.value=t,this.search(e))}}search(e){const t={value:this.value.value},n=e?e(t):t;return this.customSearch({payload:n})}async customSearch({url:e,payload:t}){this.timeout&&(this.controller.abort(),clearTimeout(this.timeout)),this.controller=new AbortController,this.timeout=setTimeout(async()=>{this.state.loading(),this.reset();const n=e||this.options.url,{data:i}=await m.post(`${n}/search`,t||this.options.payload,{signal:this.controller.signal}).catch(o=>{throw this.state.failed(),o});this.result.value=i.result,this.state.loaded()},500)}async restore(e,t){this.state.loading(),this.reset();const n=e||this.options.url,{data:i}=await m.post(`${n}/restore`,t||this.options.payload).catch(o=>{throw this.state.failed(),o});return this.state.loaded(),i}reset(){this.result.value=[]}}const sr={name:"WyxosTags",props:{path:{type:String,required:!0},modelValue:{type:Array,required:!0},formatter:{type:Function,required:!0},excludeFormatter:{type:Function,default:null},restoreFormatter:{type:Function,default:r=>r},payloadFormatter:{type:Function,default:r=>r},openOnFocus:{type:Boolean,default:!1}},emits:["update:modelValue","update:query","change"],setup(){return{search:x.create()}},data(){return{query:[],isInternalChange:!1}},watch:{modelValue:{handler:async function(r,e){this.isInternalChange?this.isInternalChange=!1:JSON.stringify(r)!==JSON.stringify(e)&&this.restore()},deep:!0,immediate:!1}},async mounted(){this.restore()},methods:{async restore(){if(this.modelValue&&this.modelValue.length){this.isInternalChange=!0;const{result:r}=await this.search.restore(this.path,this.restoreFormatter({values:this.modelValue}));this.query=r,this.$emit("update:modelValue",this.query.map(e=>this.formatter(e))),this.$emit("update:query",this.query)}},onTagSearch(r){return this.search.customSearch({url:this.path,payload:this.payloadFormatter({value:r,exclude:this.query.map(e=>this.excludeFormatter(e)).filter(Boolean)})})},onTagAdded(){this.isInternalChange=!0;const r=this.query.map(e=>this.formatter(e));this.$emit("update:modelValue",r),this.$emit("update:query",this.query),this.$emit("change")},onTagRemoved(){this.isInternalChange=!0;const r=this.query.map(e=>this.formatter(e));this.$emit("update:modelValue",r),this.$emit("update:query",this.query),this.$emit("change")},reset(){this.isInternalChange=!0,this.query=[],this.$emit("update:modelValue",this.query),this.$emit("update:query",this.query)},addItem(){this.$refs.tagInput.addItem()},focus(){console.log(this.openOnFocus),this.openOnFocus&&this.onTagSearch("")}}};function nr(r,e,t,n,i,o){const a=s.resolveComponent("o-taginput");return s.openBlock(),s.createBlock(a,s.mergeProps({ref:"tagInput",modelValue:i.query,"onUpdate:modelValue":e[0]||(e[0]=l=>i.query=l),data:n.search.result.value,"open-on-focus":t.openOnFocus,"allow-autocomplete":""},r.$attrs,{onAdd:e[1]||(e[1]=l=>o.onTagAdded(l)),onFocus:e[2]||(e[2]=l=>o.onTagSearch("")),onRemove:e[3]||(e[3]=l=>o.onTagRemoved(l)),onTyping:e[4]||(e[4]=l=>o.onTagSearch(l))}),null,16,["modelValue","data","open-on-focus"])}const fe=g(sr,[["render",nr]]),ir=Object.freeze(Object.defineProperty({__proto__:null,default:fe},Symbol.toStringTag,{value:"Module"})),or={name:"WyxosTokenExpired",emits:["close"],methods:{async proceed(){this.$emit("close",{action:!0})}}},ar={class:"bg-white p-6"},lr=s.createElementVNode("h2",{class:"title"},"Session expired",-1),cr=s.createElementVNode("p",{class:"mb-6"}," Your tab has been idle for a while. We've refreshed your session for you. If you encountered an error after performing an action, please close this prompt and try again. ",-1),dr={class:"buttons"};function ur(r,e,t,n,i,o){const a=s.resolveComponent("w-button"),l=s.resolveComponent("o-modal");return s.openBlock(),s.createBlock(l,{active:!0},{default:s.withCtx(()=>[s.createElementVNode("div",ar,[lr,cr,s.createElementVNode("div",dr,[s.createVNode(a,{class:"button is-primary",onClick:e[0]||(e[0]=c=>r.$emit("close",{action:!0}))},{default:s.withCtx(()=>[s.createTextVNode(" Confirm ")]),_:1})])])]),_:1})}const R=g(or,[["render",ur]]),hr=Object.freeze(Object.defineProperty({__proto__:null,default:R},Symbol.toStringTag,{value:"Module"}));class mr{constructor(e){this.data=new FormData,this.form=e,this.copy=Object.assign({},JSON.parse(JSON.stringify(e)))}static build(e,t){return new this(e).files(t).get()}static callback(e){return t=>this.build(t,e).get()}files(e){return e.forEach(t=>{typeof t=="object"?(this.data.append(t.name,t.value),delete this.copy[t.name]):this.form[t]&&(this.data.append(t,this.form[t]),delete this.copy[t])}),this}add(e,t){return this.data.append(e,t),this}get(){return this.data.append("payload",JSON.stringify(this.copy)),this.data}}class L{constructor(){h(this,"state",s.ref(!1))}get isVisible(){return this.state}static create(){return new L}show(){this.state=!0}hide(){this.state=!1}}class fr{static create(e,t=null,n=null){return t=t||e,{value:e,label:t}}}class gr{constructor(){h(this,"structure",{});h(this,"query",s.reactive({items:[],perPage:0,total:0,isLoading:!1,isLoaded:!1,isFilterActive:!1}));h(this,"params",s.reactive({page:1}));h(this,"router",null)}static create(e,t={},n={},i){n=Object.assign({base:"/api/admin",route:`${e}.index`},n);const o=n.base,a={route:n.route,index:n.index||`${o}/${e}/index`,destroy:`${o}/${e}/destroy`},l=new this;return l.options=n,l.structure=t,l.params=Object.assign(l.params,t),l.router=i,l.urls=a,l}async fetch(e){this.query.isLoading=!0,this.query.isLoaded=!1;const{data:t}=await m.get(e||this.urls.index,{params:this.params}).catch(n=>{throw this.query.isLoading=!1,n});return await this.router.push({name:this.urls.route,query:this.params}),this.query.isLoading=!1,this.query.isLoaded=!0,t}async load(e){const t=await this.fetch(e);return Object.assign(this.query,t.query,{items:t.query.items.map(n=>({...n,isProcessing:!1}))}),t}onPageChange(e){return this.params.page=e,this.load()}async action(e,{row:t,index:n,remove:i,method:o},a={}){t.isProcessing=!0;const l={id:t.id,...a};if(o==="delete"){const{data:c}=await m.delete(e,{data:l}).catch(u=>{throw t.isProcessing=!1,u});t.isProcessing=!1,c.row&&Object.assign(t,c.row)}else{const{data:c}=await m.post(e,l).catch(u=>{throw t.isProcessing=!1,u});t.isProcessing=!1,c.row&&Object.assign(t,c.row)}if(i){const c=await this.fetch();if(this.query.items.splice(n,1),!c.query.items.length){this.params.page--,await this.load();return}this.query.items.length<c.query.items.length&&this.query.items.push(c.query.items[c.query.items.length-1])}}destroy(e,t){return this.action(this.urls.destroy,{...e,remove:!0},t)}async resetFilter(e=null){Object.assign(this.params,this.structure),this.query.isFilterActive=!1,await this.load(e)}}class pr{constructor(e){h(this,"current",s.ref(null));h(this,"history",s.ref([]));h(this,"flow",[]);this.current.value=e}is(e){return this.current.value===e}isAny(...e){return!!e.includes(this.current.value)}setFlow(e){this.flow=e}next(){const e=this.flow.findIndex(n=>n===this.getCurrent()),t=this.flow[e+1];if(t){this.set(t);return}throw Error(`No step defined after ${this.getCurrent()}`)}set(e){this.current.value=e,this.history.value.push(e)}previous(){this.history.value.pop(),this.current.value=this.history.value[this.history.value.length-1]}getCurrent(){return this.current.value}assign(e){Object.assign(this,e)}}class W{constructor(e){h(this,"attributes",s.reactive({name:null}));h(this,"callbacks",{});this.attributes.name=e}is(e){return this.attributes.name===e}onChange(e){this.callbacks=e}activeClass(e,t){return{class:this.is(e)?t:[]}}set(e){this.attributes.name=e,this.callbacks[e]&&this.callbacks[e]()}assign(e){Object.assign(this,e)}static create(e){return new W(e)}}class yr{constructor(){h(this,"attributes",s.reactive({user:null}));h(this,"state",new y);return new Proxy(this,{get(e,t,n){return Reflect.has(e,t)?Reflect.get(e,t,n):t in e.attributes?e.attributes[t]:null},set(e,t,n,i){return!Reflect.has(e,t)&&!(t in e.attributes)?(Reflect.set(e,t,n,i),!0):t in e.attributes?(e.attributes[t]=n,!0):Reflect.set(e,t,n,i)}})}get isLoading(){return this.state.isLoading}get isLoaded(){return this.state.isLoaded}get isFailure(){return this.state.isFailure}get isAuthenticated(){return!!this.attributes.user}async load(){this.loading(),await m.get("/sanctum/csrf-cookie").catch(t=>{throw this.failed(),t});const{data:e}=await m.get("/api/user");if(!("user"in e))throw Error("Instance of user is not defined.");Object.keys(e).forEach(t=>{this.attributes[t]=e[t]}),this.loaded()}loading(){return this.state.loading()}loaded(){return this.state.loaded()}failed(){return this.state.failed()}reset(){this.attributes=s.reactive({user:null}),this.state.reset()}}const br=new yr;async function _r(r={}){return(await k.useOruga().modal.open({component:T,props:Object.assign({title:"Confirm",message:"Are you sure you want proceed?",confirmText:"Yes",cancelText:"Cancel"},r),trapFocus:!0}).promise).action}const Sr={UK_TIME:"DD/MM/YYYY HH:mm:ss",UK:"DD/MM/YYYY",DB_TIME:"YYYY-MM-DD HH:mm:ss",DB:"YYYY-MM-DD"};class wr{constructor(){h(this,"FORMATS",Sr)}format(e,t,n=""){return e?_(e).format(t):n}}const Cr=new wr;async function ge(r,e){var o,a,l,c,u,S;if((r==null?void 0:r.code)==="ERR_CANCELED")return Promise.reject(r);const t={401:"Authentication required. Please reload the page and sign in.",403:"You do not have permission to perform this action.",404:"The page or action you are looking for could not be found.",419:"Your session has likely expired. Try again or reload the page.",422:"The action attempted was invalid. Please review your input and try again.",500:"An unexpected error has occurred. This issue has been reported.",503:"The site is currently under maintenance. Please try again later."};Object.assign(t,(e==null?void 0:e.messages)||{});const n=t[(o=r.response)==null?void 0:o.status]||t[500],i=k.useOruga();if(i.notification.open({message:n,duration:1e3*5,variant:"danger",position:"bottom-right",closable:!0}),((a=r.response)==null?void 0:a.status)===419){i.modal.open({component:((l=e.components)==null?void 0:l.TokenExpired)||R,trapFocus:!0,closable:!1});const F=(await m.get("/heartbeat")).data.csrfToken;m.defaults.headers.common["X-CSRF-TOKEN"]=F}return((c=r.response)==null?void 0:c.status)===401&&i.modal.open({component:((u=e.components)==null?void 0:u.SessionExpired)||P,trapFocus:!0,closable:!1}),((S=r.response)==null?void 0:S.status)===422&&new Promise(b=>setTimeout(b,500)).then(()=>{const b=document.querySelectorAll(".o-field__message-danger"),F=be=>{const _e=be.getBoundingClientRect(),I=window.getComputedStyle(be);return _e.width>0&&_e.height>0&&I.display!=="none"&&I.visibility!=="hidden"&&I.opacity!=="0"},p=Array.from(b).find(F);p?(console.log("Scrolling to visible error message element:",p),p.closest(".o-field").scrollIntoView({behavior:"smooth"})):console.error("Could not find a visible error message element.")}),Promise.reject(r)}function Vr(r){k.useOruga().notification.open({message:r||"Action successful.",duration:2500,variant:"success",position:"bottom-right",closable:!0})}function Or(r){m.interceptors.response.use(null,e=>ge(e,r))}const pe=Object.assign({"./components/WyxosButton.vue":Ve,"./components/WyxosCollection.vue":ke,"./components/WyxosConfirm.vue":Te,"./components/WyxosDatepicker.vue":Le,"./components/WyxosError.vue":Ue,"./components/WyxosForm.vue":tt,"./components/WyxosImage.vue":it,"./components/WyxosInput.vue":lt,"./components/WyxosListing.vue":ft,"./components/WyxosLiveInput.vue":yt,"./components/WyxosLogout.vue":St,"./components/WyxosProgress.vue":Et,"./components/WyxosPrompt.vue":xt,"./components/WyxosRemove.vue":Lt,"./components/WyxosSelect.vue":Dt,"./components/WyxosSessionExpired.vue":Kt,"./components/WyxosSubmit.vue":rr,"./components/WyxosTags.vue":ir,"./components/WyxosTokenExpired.vue":hr}),ye={},Er={install:(r,e={})=>{e={vision:{},oruga:{},use:{oruga:!0},...e},e.use.oruga&&r.use(k,e.oruga),Object.keys(pe).forEach(t=>{const n=pe[t];if(n&&n.default){const i=n.default,o=i.name;o?(r.component(o,i),r.component(o.replace("Wyxos","W"),i),ye[o]=i):console.error(`Component in '${t}' does not have a name property`)}else console.error(`Could not load component from '${t}'`)}),r.config.globalProperties.$v={to:(t,n)=>({name:t,params:n})},Or(e)},...ye};d.FileRequest=mr,d.FormBuilder=w,d.Listing=E,d.LoadState=y,d.Modal=L,d.Option=fr,d.ResourceList=gr,d.Search=x,d.Steps=pr,d.Tab=W,d.WyxosButton=A,d.WyxosCollection=D,d.WyxosConfirm=U,d.WyxosDatepicker=M,d.WyxosError=z,d.WyxosForm=ne,d.WyxosImage=ie,d.WyxosInput=oe,d.WyxosListing=ae,d.WyxosLiveInput=le,d.WyxosLogout=ce,d.WyxosProgress=de,d.WyxosPrompt=T,d.WyxosRemove=ue,d.WyxosSelect=he,d.WyxosSessionExpired=P,d.WyxosSubmit=me,d.WyxosTags=fe,d.WyxosTokenExpired=R,d.auth=br,d.confirm=_r,d.dateRender=Cr,d.default=Er,d.errorHandler=ge,d.success=Vr,d.useFormErrors=O,Object.defineProperties(d,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
//# sourceMappingURL=vision.umd.cjs.map
